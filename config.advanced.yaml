# config/models.yaml - 高级配置
# 包含所有详细参数，供参考和调整

app:
  # 运行模式:
  # "stream"  : 边录边识别 (流式)
  # "offline" : 录音结束后统一识别 (非流式/整句识别)
  mode: "offline"

  # 快捷键配置
  hotkeys:
    std: "ctrl+f2"  # 开始/停止录音的快捷键
    llm: "ctrl+f1"  # AI 录音快捷键
    exit_key: "ctrl+esc"  # 退出程序的按键

  # ASR 模型选择 (与主配置一致)
  asr_model: "sense_voice"  # paraformer / sense_voice / funasr

# =============================================================================
# ASR 高级配置 - 模型路径和详细参数
# =============================================================================

asr:
  # 模型配置 - 根据 asr_model 自动选择
  models:
    paraformer:
      streaming:
        tokens: "./ckpts/sherpa-onnx-streaming-paraformer-bilingual-zh-en/tokens.txt"
        encoder: "./ckpts/sherpa-onnx-streaming-paraformer-bilingual-zh-en/encoder.int8.onnx"
        decoder: "./ckpts/sherpa-onnx-streaming-paraformer-bilingual-zh-en/decoder.int8.onnx"

      # 标点模型 (仅 paraformer 需要)
      punctuation:
        enabled: true
        model: "./ckpts/sherpa-onnx-punct-ct-transformer-zh-en-vocab272727-2024-04-12/model.onnx"
        num_threads: 1
        provider: "cpu"

    sense_voice:
      model: "./ckpts/sherpa-onnx-sense-voice-zh-en-ja-ko-yue-2024-07-17/model.onnx"
      tokens: "./ckpts/sherpa-onnx-sense-voice-zh-en-ja-ko-yue-2024-07-17/tokens.txt"
      language: "auto"  # auto/zh/en/ja/ko/yue
      use_itn: true     # 逆文本标准化

      # VAD 配置 (仅 sense_voice 需要)
      vad:
        model: "./ckpts/vad/ten-vad.onnx"
        type: "ten_vad"  # silero_vad / ten_vad
        threshold: 0.5
        min_silence_duration: 0.1
        min_speech_duration: 0.25
        max_speech_duration: 5.0
        window_size: 512

    funasr:
      # FunASR 模型配置 - 仅 model_dir 可配置，其他参数固定
      model_dir: "FunAudioLLM/Fun-ASR-Nano-2512"  # 模型目录（唯一可配置参数）
      device: "cuda"          # 设备: cuda:0 / cpu
      sample_rate: 16000      # 采样率
      chunk_size: 1000        # 流式块大小(毫秒)
      enable_vad: true        # 是否启用VAD（流式模式）
      num_threads: 4          # CPU线程数

      # VAD 配置（用于流式模式，与sense_voice类似）
      vad_model: "ten-vad"    # VAD模型: ten-vad / silero-vad
      vad_kwargs:
        threshold: 0.5
        min_silence_duration: 0.1
        min_speech_duration: 0.25
        max_speech_duration: 8.0
        window_size: 512

  # =============================================================================
  # 性能优化配置
  # =============================================================================
  performance:
    # 通用参数
    num_threads: 1
    provider: "cpu"  # cpu / cuda
    device: 0        # GPU 索引
    sample_rate: 16000
    feature_dim: 80

    # VAD 端点检测 (适用于 paraformer)
    endpoint_detection:
      enable: true
      rule1_min_trailing_silence: 2.4
      rule2_min_trailing_silence: 1.2
      rule3_min_utterance_length: 30

    # 解码配置
    decoding:
      method: "greedy_search"  # greedy_search / modified_beam_search
      debug: false

  # =============================================================================
  # 热词与语言模型配置
  # =============================================================================
  hotwords:
    # 热词词典路径
    dict_dir: "./ckpts/hr-files/dict"
    lexicon: "./ckpts/hr-files/lexicon.txt"

    # 高级规则 (可选)
    # rule_fsts: "./ckpts/hr-files/replace.fst"
    # rule_fars: ""

# =============================================================================
# LLM 高级配置 (可选)
# =============================================================================

llm:
  # 连接参数
  base_url: "http://localhost:11434/v1"
  api_key: "sk-han8113261"
  model: "qwen3:1.7b-q8_0"

  # 生成参数
  temperature: 0.3
  max_tokens: 2048
  top_p: 0.9
  frequency_penalty: 0.0
  presence_penalty: 0.0

  # 系统提示词
  system_prompt: ""

  # 请求超时
  timeout: 30

  # 重试配置
  max_retries: 3
  retry_delay: 1.0